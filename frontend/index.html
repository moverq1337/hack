<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Avatar - –í–∞–∫–∞–Ω—Å–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
        }
        .vacancy-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .vacancy-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }
        .vacancy-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .vacancy-company {
            font-style: italic;
            margin-bottom: 10px;
        }
        .vacancy-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        .tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        .upload-section {
            display: none;
            margin: 20px 0;
            text-align: center;
        }
        .resume-upload {
            background: rgba(255, 255, 255, 0.15);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            cursor: pointer;
        }
        .match-result {
            text-align: center;
            margin: 30px 0;
        }
        .match-score {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üöÄ HR Avatar - –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ—é –≤–∞–∫–∞–Ω—Å–∏—é</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏—é –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–µ–∑—é–º–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>

    <div id="vacanciesList">
        
    </div>

    <div id="uploadSection" class="upload-section">
        <h2>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à–µ —Ä–µ–∑—é–º–µ –¥–ª—è –≤–∞–∫–∞–Ω—Å–∏–∏ "<span id="selectedVacancyTitle"></span>"</h2>

        <div class="resume-upload" onclick="document.getElementById('resumeFile').click()">
            <input type="file" id="resumeFile" accept=".docx,.pdf,.txt" style="display: none;">
            <p>üìÅ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —Ä–µ–∑—é–º–µ (DOCX, PDF, TXT)</p>
            <p><small>–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</small></p>
        </div>

        <div id="fileName" style="margin: 10px 0;"></div>
        <button onclick="analyzeResume()" id="analyzeBtn" disabled>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—é–º–µ</button>
    </div>

    <div id="matchResult" class="upload-section">
        <div class="match-result">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h2>
            <div class="match-score">
                <span id="matchPercent">0</span>%
            </div>
            <p>–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –≤–∞–∫–∞–Ω—Å–∏–µ–π</p>
            <button onclick="startInterview()" id="interviewBtn">–ù–∞—á–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ</button>
        </div>
    </div>
</div>

<script>
    let selectedVacancy = null;
    let resumeData = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π
    async function loadVacancies() {
        try {
            const response = await fetch('/api/vacancies');
            const vacancies = await response.json();

            const vacanciesList = document.getElementById('vacanciesList');
            vacancies.forEach(vacancy => {
                const vacancyCard = document.createElement('div');
                vacancyCard.className = 'vacancy-card';
                vacancyCard.innerHTML = `
                        <div class="vacancy-title">${vacancy.title}</div>
                        <div class="vacancy-company">${vacancy.company} ‚Ä¢ ${vacancy.location}</div>
                        <div class="vacancy-description">${vacancy.description}</div>
                        <div class="vacancy-tags">
                            ${vacancy.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div>–û–ø—ã—Ç: ${vacancy.experience}</div>
                        <div>–ó–∞—Ä–ø–ª–∞—Ç–∞: ${vacancy.salary}</div>
                    `;
                vacancyCard.addEventListener('click', () => selectVacancy(vacancy));
                vacanciesList.appendChild(vacancyCard);
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞–∫–∞–Ω—Å–∏–π:', error);
            // –ó–∞–≥–ª—É—à–∫–∞ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏
            const vacanciesList = document.getElementById('vacanciesList');
            vacanciesList.innerHTML = `
                    <div class="vacancy-card" onclick="selectVacancy({
                        id: 1,
                        title: 'Backend Developer (Go)',
                        company: 'TechCorp',
                        location: '–ú–æ—Å–∫–≤–∞',
                        description: '–ò—â–µ–º –æ–ø—ã—Ç–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å –∑–Ω–∞–Ω–∏–µ–º Go, Docker –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.',
                        tags: ['Go', 'Docker', 'Kubernetes', 'gRPC', 'PostgreSQL'],
                        experience: '3+ years',
                        salary: '–æ—Ç 150 000 —Ä—É–±.'
                    })">
                        <div class="vacancy-title">Backend Developer (Go)</div>
                        <div class="vacancy-company">TechCorp ‚Ä¢ –ú–æ—Å–∫–≤–∞</div>
                        <div class="vacancy-description">–ò—â–µ–º –æ–ø—ã—Ç–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å –∑–Ω–∞–Ω–∏–µ–º Go, Docker –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.</div>
                        <div class="vacancy-tags">
                            <span class="tag">Go</span>
                            <span class="tag">Docker</span>
                            <span class="tag">Kubernetes</span>
                            <span class="tag">gRPC</span>
                            <span class="tag">PostgreSQL</span>
                        </div>
                        <div>–û–ø—ã—Ç: 3+ years</div>
                        <div>–ó–∞—Ä–ø–ª–∞—Ç–∞: –æ—Ç 150 000 —Ä—É–±.</div>
                    </div>

                    <div class="vacancy-card" onclick="selectVacancy({
                        id: 2,
                        title: 'DevOps Engineer',
                        company: 'CloudSolutions',
                        location: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥',
                        description: '–¢—Ä–µ–±—É–µ—Ç—Å—è DevOps –∏–Ω–∂–µ–Ω–µ—Ä –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.',
                        tags: ['Docker', 'Kubernetes', 'AWS', 'CI/CD', 'Terraform'],
                        experience: '2+ years',
                        salary: '–æ—Ç 180 000 —Ä—É–±.'
                    })">
                        <div class="vacancy-title">DevOps Engineer</div>
                        <div class="vacancy-company">CloudSolutions ‚Ä¢ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</div>
                        <div class="vacancy-description">–¢—Ä–µ–±—É–µ—Ç—Å—è DevOps –∏–Ω–∂–µ–Ω–µ—Ä –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CI/CD –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.</div>
                        <div class="vacancy-tags">
                            <span class="tag">Docker</span>
                            <span class="tag">Kubernetes</span>
                            <span class="tag">AWS</span>
                            <span class="tag">CI/CD</span>
                            <span class="tag">Terraform</span>
                        </div>
                        <div>–û–ø—ã—Ç: 2+ years</div>
                        <div>–ó–∞—Ä–ø–ª–∞—Ç–∞: –æ—Ç 180 000 —Ä—É–±.</div>
                    </div>
                `;
        }
    }

    function selectVacancy(vacancy) {
        selectedVacancy = vacancy;
        document.getElementById('selectedVacancyTitle').textContent = vacancy.title;
        document.getElementById('uploadSection').style.display = 'block';
        document.getElementById('matchResult').style.display = 'none';

        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–∞–∑–¥–µ–ª—É –∑–∞–≥—Ä—É–∑–∫–∏
        document.getElementById('uploadSection').scrollIntoView({ behavior: 'smooth' });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
    document.getElementById('resumeFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            document.getElementById('fileName').textContent = `–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${file.name}`;
            document.getElementById('analyzeBtn').disabled = false;

            // –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
            const reader = new FileReader();
            reader.onload = function(e) {
                resumeData = {
                    name: file.name,
                    content: e.target.result,
                    type: file.type
                };
            };
            reader.readAsText(file);
        }
    });

    // –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—é–º–µ
    async function analyzeResume() {
        if (!selectedVacancy || !resumeData) return;

        try {
            const response = await fetch('/api/analyze-resume', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    vacancy: selectedVacancy,
                    resume: resumeData
                })
            });

            const result = await response.json();
            if (result.match_score) {
                document.getElementById('matchPercent').textContent = result.match_score;
                localStorage.setItem('matchScore', result.match_score);
            }
            if (result.feedback) {
                console.log("–§–∏–¥–±–µ–∫ –ø–æ —Ä–µ–∑—é–º–µ:", result.feedback);
            }

            document.getElementById('matchResult').style.display = 'block';
            document.getElementById('matchResult').scrollIntoView({ behavior: 'smooth' });

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—é–º–µ:', error);
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ä–µ–∑—é–º–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
        }
    }


    // –ù–∞—á–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ
    function startInterview() {
        if (!selectedVacancy) return;

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–Ω—Ç–µ—Ä–≤—å—é
        localStorage.setItem('selectedVacancy', JSON.stringify(selectedVacancy));
        localStorage.setItem('resumeData', JSON.stringify(resumeData));

        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω—Ç–µ—Ä–≤—å—é
        window.location.href = 'interview.html';
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadVacancies();
</script>
</body>
</html>